"use strict";(self.webpackChunkmidi_playground=self.webpackChunkmidi_playground||[]).push([[88],{6985:function(e,n,t){t.d(n,{PW:function(){return o},Qz:function(){return c},f5:function(){return u},mr:function(){return s}});var r=t(9439),a=t(4896),c=function(e){var n=Math.floor(e/a.$c.length),t=e%a.$c.length;return"".concat(a.$c[t]).concat(n)},o=function(e){var n=(e||"").match(/(.{1,2})(\d{1})/)||[],t=(0,r.Z)(n,3),c=(t[0],t[1]),o=t[2];return c&&o?parseInt(o)*a.$c.length+a.$c.findIndex((function(e){return e===c.toUpperCase()})):null},s=function(e){return e[0]>=a.wm&&e[0]<=a.wm+a.J5&&e[2]>0},u=function(e){return e[0]>=a.$Z&&e[0]<=a.$Z+a.J5||e[0]>=a.wm&&e[0]<=a.wm+a.J5&&0===e[2]}},8088:function(e,n,t){t.r(n),t.d(n,{default:function(){return Q}});var r,a=t(9439),c=t(1413),o=t(2791),s=t(7075),u=t(5987),i=t(184),l=["children","className","index","onClick"],d=function(e){var n=e.children,t=e.className,r=(e.index,e.onClick),a=(0,u.Z)(e,l);return(0,i.jsxs)("div",(0,c.Z)((0,c.Z)({className:"keyboard-button ".concat(t),onClick:r},a),{},{children:[(0,i.jsx)("div",{className:"button-overlay"}),(0,i.jsx)("div",{className:"button-inner",children:n})]}))},f=["active","children","className","index","on","onClick","onWheel"],m=function(e){var n=e.active,t=e.children,r=e.className,a=e.index,s=e.on,l=e.onClick,d=e.onWheel,m=(0,u.Z)(e,f),v=o.useCallback((function(e){l&&l(a,s,e)}),[a,s,l]),h=o.useCallback((function(e){d&&d(a,e.deltaY<0?"up":"down",e)}),[a,d]);return(0,i.jsxs)("div",(0,c.Z)((0,c.Z)({className:"keyboard-pad ".concat(r," ").concat(n&&"active"," ").concat(s&&"on"),onClick:v,onWheel:h},m),{},{children:[(0,i.jsx)("div",{className:"pad-overlay"}),(0,i.jsx)("div",{className:"pad-inner",children:t})]}))},v=t(763),h=-144,p=function(e){var n=e.centerBased,t=e.className,r=e.displayValue,a=e.max,s=e.min,u=e.onSetValue,l=e.step,d=void 0===l?1:l,f=e.style,m=e.title,p=e.value,x=o.useRef({factor:1}),Z=o.useMemo((function(){return(0,v.debounce)((function(){x.current.factor=d}),25)}),[d]),k=o.useMemo((function(){return function(e,n,t){var r=288*(e-n)/(t-n)+h;return Math.max(h,Math.min(144,r))}(p,s,a)}),[p,s,a]),b=o.useCallback((function(e){var n=p+d*x.current.factor*(e.deltaY<0?1:-1);u(Math.min(a,Math.max(s,n))),x.current.factor+=d,Z()}),[p,d,s,a]);return(0,i.jsxs)("div",{className:"rotary-knob ".concat(r&&"with-value"," ").concat(m&&"with-title"," ").concat(t),style:f,children:[m&&(0,i.jsx)("div",{className:"title",children:m}),(0,i.jsx)("div",{className:"knob-overlay",onWheel:b}),(0,i.jsxs)("div",{className:"knob-inner",children:[(0,i.jsx)("div",{className:"marker",style:{transform:"rotate(".concat(k,"deg)")}}),(0,i.jsx)("div",{className:"ticks",children:Array.from(Array(25)).map((function(e,t){return(0,i.jsx)("div",(0,c.Z)({},function(e,n,t){var r=h+12*e;return{className:"tick ".concat((t?n<0?r<=0&&r>=n:r>=0&&r<=n:n>h&&r<=n)&&"active"),key:e,style:{transform:"rotate(".concat(r,"deg)")}}}(t,k,n)),t)}))})]}),r&&(0,i.jsx)("div",{className:"value-wrap",children:(0,i.jsx)("div",{className:"value-display",children:p})})]})},x=["name","onSetParameter"],Z=function(e){var n=e.name,t=e.onSetParameter,r=(0,u.Z)(e,x),a=o.useCallback((function(e){return t(n,e)}),[n,t]);return(0,i.jsx)("div",{className:"parameter-knob",children:(0,i.jsx)(p,(0,c.Z)({displayValue:!0,onSetValue:a},r))})},k=t(6985),b=function(e,n,t,r,a){return{centerBased:!0===a,defaultValue:t,max:n,min:e,title:r}},j=(r={bpm:138,noteDuration:100,notes:"G3 D4 G4 C5 D5 D#4 G4 A#4 D#5 F5 B3 G4 G#4 D5 D#5 F5 G5 G3 D4 G4 C5 D5 F4 G4 A#4 D#5 F5 C4 G4 G#4 D5 D#5",noteValue:16},(0,c.Z)((0,c.Z)({},r),{},{notes:r.notes.split(" ").map(k.PW)})),y={noteDuration:b(1,300,j.noteDuration,"Note Duration"),transpose:b(-24,24,0,"Transpose",!0)},N={bpm:b(40,280,j.bpm,"Tempo"),noteValue:b(1,32,j.noteValue,"NoteValue")},g=t(4942),C=t(6270),I=t(7269),D=["notes"],S=["notes"],w=["bpm","noteValue"],M=function(e,n){return 6e4/e*4/n},G=function(e){if(!Array.isArray(e))return[];for(var n=e[0].notes.length,t=0;t<e.length;t++)e[t].length>n&&(n=e[t].length);return Array.from(Array(n)).map((function(n,t){return e.map((function(e){var n=e.channels,r=e.notes,a=e.noteDuration,c=e.transpose,o=e.velocity;return{channels:n,duration:a,note:r[t].note+c,on:r[t].on,velocity:o}}))}))},O=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=o.useState(e.reduce((function(e,t){return e[t.name]=n[t.name]||t.defaultValue,e}),{})),r=(0,a.Z)(t,2),s=r[0],u=r[1],i=o.useCallback((function(e,n){return u((function(t){return(0,c.Z)((0,c.Z)({},t),{},(0,g.Z)({},e,n))}))}),[]);return{onSetParameter:i,parameters:s}},E={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M347.6 528.95l383.2 301.02c14.25 11.2 35.2 1.1 35.2-16.95V210.97c0-18.05-20.95-28.14-35.2-16.94L347.6 495.05a21.53 21.53 0 000 33.9M330 864h-64a8 8 0 01-8-8V168a8 8 0 018-8h64a8 8 0 018 8v688a8 8 0 01-8 8"}}]},name:"step-backward",theme:"outlined"},V=t(4291),P=function(e,n){return o.createElement(V.Z,(0,c.Z)((0,c.Z)({},e),{},{ref:n,icon:E}))};P.displayName="StepBackwardOutlined";var R=o.forwardRef(P),A={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M715.8 493.5L335 165.1c-14.2-12.2-35-1.2-35 18.5v656.8c0 19.7 20.8 30.7 35 18.5l380.8-328.4c10.9-9.4 10.9-27.6 0-37z"}}]},name:"caret-right",theme:"outlined"},q=function(e,n){return o.createElement(V.Z,(0,c.Z)((0,c.Z)({},e),{},{ref:n,icon:A}))};q.displayName="CaretRightOutlined";var B=o.forwardRef(q),W={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M304 176h80v672h-80zm408 0h-64c-4.4 0-8 3.6-8 8v656c0 4.4 3.6 8 8 8h64c4.4 0 8-3.6 8-8V184c0-4.4-3.6-8-8-8z"}}]},name:"pause",theme:"outlined"},$=function(e,n){return o.createElement(V.Z,(0,c.Z)((0,c.Z)({},e),{},{ref:n,icon:W}))};$.displayName="PauseOutlined";var z=o.forwardRef($),F=Object.keys(y).map((function(e){return(0,c.Z)((0,c.Z)({},y[e]),{},{name:e})})),T=function(e){var n=e.activeNoteIdx,t=e.data,r=e.onSetData,a=t.noteDuration,l=t.transpose,d=o.useMemo((function(){return{noteDuration:a,transpose:l}}),[a,l]),f=O(F,d),v=f.parameters,h=f.onSetParameter;o.useEffect((function(){return r((function(e){return(0,c.Z)((0,c.Z)({},e),v)}))}),[v]);var p,x=(p=r,{onClick:o.useCallback((function(e){return p((function(n){return n.notes,(0,u.Z)(n,D).map((function(n,t){return t===e?(0,c.Z)((0,c.Z)({},n),{},{on:!n.on}):n}))}))}),[p]),onWheel:o.useCallback((function(e,n){return p((function(t){var r=t.notes,a=(0,u.Z)(t,S);return(0,c.Z)((0,c.Z)({},a),{},{notes:r.map((function(t,r){return r===e?(0,c.Z)((0,c.Z)({},t),{},{note:"up"===n?t.note+1:t.note-1}):t}))})}))}),[p])});return(0,i.jsxs)("div",{className:"step-sequencer",children:[(0,i.jsx)("div",{className:"controls",children:(0,i.jsx)(s.Z,{bordered:!1,children:F.map((function(e){return(0,o.createElement)(Z,(0,c.Z)((0,c.Z)({},e),{},{key:e.name,onSetParameter:h,value:v[e.name]}))}))})}),(0,i.jsx)("div",{className:"pads-container",children:Array.isArray(null===t||void 0===t?void 0:t.notes)&&t.notes.map((function(e,t){var r=e.note,a=e.on;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(m,(0,c.Z)((0,c.Z)({active:n===t,index:t,on:a},x),{},{children:(0,k.Qz)(r)}),r),(t+1)%8===0&&(0,i.jsx)("div",{className:"flex-breaker"})]})}))})]})},J=[1,2,3,4],L=Object.keys(N).map((function(e){return(0,c.Z)((0,c.Z)({},N[e]),{},{name:e})})),Q=function(){var e=o.useState([{channels:J,noteDuration:j.noteDuration,notes:j.notes.map((function(e){return{note:e,on:!0}})),transpose:0,velocity:50}]),n=(0,a.Z)(e,2),t=n[0],r=n[1],l=o.useState(0),f=(0,a.Z)(l,2),m=f[0],v=(f[1],o.useCallback((function(e){var n="function"===typeof e?e:function(){return e};r((function(e){return e.map((function(e,t){return t===m?n(e):e}))}))}),[r,m])),h=O(L),p=h.parameters,x=h.onSetParameter,k=function(e,n,t){var r=e.bpm,s=e.noteValue,i=(0,u.Z)(e,w),l=o.useContext(C.Z),d=l.selectedOutput,f=o.useState(null),m=(0,a.Z)(f,2),v=m[0],h=m[1],p=o.useRef((0,c.Z)((0,c.Z)({},i),{},{intervalId:null,intervalMillis:M(r,s),noteIdx:0,steps:G(n),tempoChangeRequested:null}));o.useEffect((function(){null!==p.current.intervalId?p.current.tempoChangeRequested=M(r,s):p.current.intervalMillis=M(r,s)}),[r,s]),o.useEffect((function(){Object.keys(i).forEach((function(e){p.current[e]=i[e]}))}),[i]),o.useEffect((function(){p.current.steps=G(n)}),[n]);var x=o.useCallback((function(){var e=p.current,n=e.steps,t=e.noteIdx,r=e.tempoChangeRequested;r&&(clearInterval(p.current.intervalId),p.current.intervalMillis=r,p.current.tempoChangeRequested=null,p.current.intervalId=setInterval(x,r));var a=n[t];h(t),p.current.noteIdx++,p.current.noteIdx>=n.length&&(p.current.noteIdx=0);var c=a.reduce((function(e,n){var t=n.channels,r=n.duration,a=n.note,c=n.on,o=n.velocity;return c&&o>0&&t.forEach((function(n){e.messages.push([I.XR["Channel".concat(n,"NoteOn")],a,o]),e.messagesOffGroups[r]||(e.messagesOffGroups[r]=[]),e.messagesOffGroups[r].push([I.XR["Channel".concat(n,"NoteOn")],a,0])})),e}),{messages:[],messagesOffGroups:{}}),o=c.messages,s=c.messagesOffGroups;o.length&&(o.forEach((function(e){return d.send(e)})),Object.keys(s).forEach((function(e){var n=s[e];setTimeout((function(){return n.forEach((function(e){return d.send(e)}))}),e)})))}),[d]);o.useEffect((function(){return t&&null!==l&&void 0!==l&&l.ready&&l.selectedOutput&&(p.current.intervalId=setInterval(x,intervalMillis)),function(){clearInterval(p.current.intervalId),p.current.intervalId=null}}),[t]);var Z=o.useCallback((function(){h(0),p.current.noteIdx=0}),[h]);return{activeNoteIdx:v,onPlay:o.useCallback((function(){null===p.current.intervalId&&(p.current.intervalId=setInterval(x,p.current.intervalMillis))}),[x]),onSeekToStart:Z,onStop:o.useCallback((function(){clearInterval(p.current.intervalId),p.current.intervalId=null}),[])}}(p,t),b=k.activeNoteIdx,y=k.onSeekToStart,N=k.onPlay,g=k.onStop;return(0,i.jsxs)("div",{className:"sequencer",children:[(0,i.jsx)("div",{className:"global-controls",children:(0,i.jsxs)(s.Z,{bordered:!1,children:[(0,i.jsxs)("div",{className:"control-row",children:[(0,i.jsx)(d,{onClick:y,children:(0,i.jsx)(R,{})}),(0,i.jsx)(d,{onClick:N,children:(0,i.jsx)(B,{})}),(0,i.jsx)(d,{onClick:g,children:(0,i.jsx)(z,{})})]}),(0,i.jsx)("div",{className:"control-row",children:L.map((function(e){return(0,o.createElement)(Z,(0,c.Z)((0,c.Z)({},e),{},{key:e.name,onSetParameter:x,value:p[e.name]}))}))})]})}),(0,i.jsx)("div",{className:"step-sequencer",children:(0,i.jsx)(T,{activeNoteIdx:b,data:t[m],onSetData:v})})]})}}}]);
//# sourceMappingURL=88.87acb09e.chunk.js.map