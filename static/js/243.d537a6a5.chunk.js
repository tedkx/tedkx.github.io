"use strict";(self.webpackChunkmidi_playground=self.webpackChunkmidi_playground||[]).push([[243],{6985:function(e,n,t){t.d(n,{PW:function(){return u},Qz:function(){return o},f5:function(){return c},mr:function(){return s}});var r=t(9439),a=t(4896),o=function(e){var n=Math.floor(e/a.$c.length),t=e%a.$c.length;return"".concat(a.$c[t]).concat(n)},u=function(e){var n=(e||"").match(/(.{1,2})(\d{1})/)||[],t=(0,r.Z)(n,3),o=(t[0],t[1]),u=t[2];return o&&u?parseInt(u)*a.$c.length+a.$c.findIndex((function(e){return e===o.toUpperCase()})):null},s=function(e){return e[0]>=a.wm&&e[0]<=a.wm+a.J5&&e[2]>0},c=function(e){return e[0]>=a.$Z&&e[0]<=a.$Z+a.J5||e[0]>=a.wm&&e[0]<=a.wm+a.J5&&0===e[2]}},6243:function(e,n,t){t.r(n),t.d(n,{default:function(){return H}});var r=t(1413),a=t(5987),o=t(9439),u=t(2791),s=t(6985),c={lawless:{bpm:90,stepSequencers:[{channels:[1],noteDuration:30,notes:"C4 G4 C5 D#5 D5 C5 D5 D#5 G5 D#5 D5 C5 G4 F4 D#4 D4 C6 C6 C6 C5 C5 C5 C6 C6 C6 G5 D#5 D5 C5 G4 D#4 D4"}],noteValue:16},theGrid:{bpm:138,stepSequencers:[{channels:[1,2,3,4],noteDuration:100,notes:"G3 D4 G4 C5 D5 D#4 G4 A#4 D#5 F5 B3 G4 G#4 D5 D#5 F5 G5 G3 D4 G4 C5 D5 F4 G4 A#4 D#5 F5 C4 G4 G#4 D5 D#5"}],noteValue:16},newMaps:{bpm:120,stepSequencers:[{channels:[1,2,3,4],noteDuration:600,notes:"C5 A#4 C5 G#5:90 C#5 G#4 D#5 C5 A#4 G#5:90 C5 G#4 C#5 D#5 A#4 C5 G#5:90 G#5:0 C5 A#4 C5 G#5 C5 A#4 C5 G#5:90 C#5 G#4 D#5 C5 A#4 G5:90 C5 G#4 C#5 D#5 A#4 C#5 A#5:90 A#5:0 C5 A#4 C5 G#5:90 C#5 G#4 D#5 C5 A#4 G#5:90 C5 G#4 C#5 D#5 A#4 C5 G#5:90 G#5:0 C5 A#4 C5 G#5 C5 A#4 C5 G#5:90 C#5 G#4 D#5 C5 A#4 G5:90 A#4 G#4 C#5 D#5 A#4 C#5 C6:90 C6:0"}],noteValue:16,velocity:54},metropolis:{bpm:120,noteValue:16,stepSequencers:[{channels:[1],noteDuration:100,notes:"C5 G5 D6 C7 B6 F6 E5 B5 F#6 F7 E7 A#6 D7 C#7 A6 C7 B6 G#6"},{channels:[1],noteDuration:100,notes:"F5 C6 G6 F7 E7 A#6 A5 E6 B6 A#7 A7 D#7 G7 F#7 D7 F7 E7 C#7"}]}},i=["stepSequencers"],l=["notes"],d=(0,s.PW)("C5"),m=function(e,n,t,r,a){return{centerBased:!0===a,defaultValue:t,max:n,min:e,title:r}},f=function(e){var n=e.stepSequencers,t=(0,a.Z)(e,i);return(0,r.Z)((0,r.Z)({},t),{},{stepSequencers:n.map((function(e){var n=e.notes,u=(0,a.Z)(e,l);return(0,r.Z)((0,r.Z)({},u),{},{transpose:0,notes:n.split(" ").map((function(e){var n=e.split(":"),r=(0,o.Z)(n,2),a=r[0],u=r[1],c=parseInt(u);return{note:(0,s.PW)(a),on:0!==c,velocity:isNaN(c)?t.velocity||64:c}}))})}))})}(c.metropolis),v={noteDuration:m(1,1e3,f.noteDuration,"Note Duration"),transpose:m(-24,24,0,"Transpose",!0)},h={bpm:m(40,280,f.bpm,"Tempo"),noteValue:m(1,32,f.noteValue,"NoteValue")},p=t(4942),C=t(6270),x=t(7269),Z=["notes"],g=["notes"],j=["bpm","noteValue"],b=function(e,n){return 6e4/e*4/n},k=function(e){if(!Array.isArray(e))return[];for(var n=e[0].notes.length,t=0;t<e.length;t++)e[t].length>n&&(n=e[t].length);return Array.from(Array(n)).map((function(n,t){return e.map((function(e){var n=e.channels,r=e.notes,a=e.noteDuration,o=e.transpose;return{channels:n,duration:a,note:r[t].note+o,on:r[t].on,velocity:r[t].velocity}}))}))},y=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=u.useState(e.reduce((function(e,t){return e[t.name]=n[t.name]||t.defaultValue,e}),{})),a=(0,o.Z)(t,2),s=a[0],c=a[1],i=u.useCallback((function(e,n){return c((function(t){return(0,r.Z)((0,r.Z)({},t),{},(0,p.Z)({},e,n))}))}),[]);return{onSetParameter:i,parameters:s}},D=t(184),N=["children","className","index","onClick"],G=function(e){var n=e.children,t=e.className,o=(e.index,e.onClick),u=(0,a.Z)(e,N);return(0,D.jsxs)("div",(0,r.Z)((0,r.Z)({className:"keyboard-button ".concat(t),onClick:o},u),{},{children:[(0,D.jsx)("div",{className:"button-overlay"}),(0,D.jsx)("div",{className:"button-inner",children:n})]}))},A=["active","children","className","index","on","onClick","onWheel"],S=function(e){var n=e.active,t=e.children,o=e.className,s=e.index,c=e.on,i=e.onClick,l=e.onWheel,d=(0,a.Z)(e,A),m=u.useCallback((function(e){i&&i(s,c,e)}),[s,c,i]),f=u.useCallback((function(e){l&&l(s,e.deltaY<0?"up":"down",e)}),[s,l]);return(0,D.jsxs)("div",(0,r.Z)((0,r.Z)({className:"keyboard-pad ".concat(o," ").concat(n&&"active"," ").concat(c&&"on"),onClick:m,onWheel:f},d),{},{children:[(0,D.jsx)("div",{className:"pad-overlay"}),(0,D.jsx)("div",{className:"pad-inner",children:t})]}))},I=t(763),w=-144,E=function(e){var n=e.centerBased,t=e.className,a=e.displayValue,s=e.max,c=e.min,i=e.style,l=e.title,d=e.value,m=u.useMemo((function(){return function(e,n,t){var r=288*(e-n)/(t-n)+w;return Math.max(w,Math.min(144,r))}(d,c,s)}),[d,c,s]),f=function(e){var n=e.max,t=e.min,r=e.onSetValue,a=e.step,o=void 0===a?1:a,s=e.value,c=u.useRef({factor:1,max:n,min:t,step:o,value:s}),i=u.useRef();u.useEffect((function(){c.current.step=o,c.current.value=s,c.current.min=t,c.current.max=n}),[s,o,t,n]);var l=u.useMemo((function(){return(0,I.debounce)((function(){c.current.factor=c.current.step}),25)}),[]);return u.useEffect((function(){var e=function(e){e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault();var n=c.current,t=n.value,a=n.step,o=n.min,u=n.max,s=t+a*c.current.factor*(e.deltaY<0?1:-1);r(Math.min(u,Math.max(o,s))),c.current.factor+=a,l()};return i.current.addEventListener("wheel",e,{passive:!1}),function(){i.current&&i.current.removeEventListener("wheel",e,{passive:!1})}}),[]),{elementRef:i}}(e),v=(f.onWheel,f.elementRef),h=function(e){var n=e.max,t=e.min,r=e.onSetValue,a=e.value,s=u.useRef({y:null,mouseMovelistener:null,mouseUplistener:null,mouseDown:!1,value:a}),c=u.useState(!1),i=(0,o.Z)(c,2),l=i[0],d=i[1];u.useEffect((function(){s.current.value=a}),[a]);var m=u.useCallback((function(e){0===e.button&&(d(!1),window.removeEventListener("mousemove",s.current.mouseMovelistener),window.removeEventListener("mouseup",s.current.mouseUplistener),s.current.listener=null)}),[d]),f=u.useCallback((function(e){var a=Math.min(n,Math.max(t,s.current.value+s.current.y-e.pageY));s.current.y=e.pageY,r(a)}),[r,t,n]);return{dragging:l,onMouseDown:u.useCallback((function(e){0===e.button&&(d(!0),s.current.y=e.pageY,s.current.mouseMovelistener=f,s.current.mouseUplistener=m,window.addEventListener("mousemove",s.current.mouseMovelistener),window.addEventListener("mouseup",s.current.mouseUplistener))}),[])}}(e),p=h.dragging,C=h.onMouseDown;return(0,D.jsxs)("div",{className:"rotary-knob ".concat(a&&"with-value"," ").concat(l&&"with-title"," ").concat(t),style:i,children:[p&&(0,D.jsx)("div",{className:"window-overlay"}),l&&(0,D.jsx)("div",{className:"title",children:l}),(0,D.jsx)("div",{className:"knob-overlay",onMouseDown:C,ref:v}),(0,D.jsxs)("div",{className:"knob-inner",children:[(0,D.jsx)("div",{className:"marker",style:{transform:"rotate(".concat(m,"deg)")}}),(0,D.jsx)("div",{className:"ticks",children:Array.from(Array(25)).map((function(e,t){return(0,D.jsx)("div",(0,r.Z)({},function(e,n,t){var r=w+12*e;return{className:"tick ".concat((t?n<0?r<=0&&r>=n:r>=0&&r<=n:n>w&&r<=n)&&"active"),key:e,style:{transform:"rotate(".concat(r,"deg)")}}}(t,m,n)),t)}))})]}),a&&(0,D.jsx)("div",{className:"value-wrap",children:(0,D.jsx)("div",{className:"value-display",children:d})})]})},M=["name","onSetParameter"],P=function(e){var n=e.name,t=e.onSetParameter,o=(0,a.Z)(e,M),s=u.useCallback((function(e){return t(n,e)}),[n,t]);return(0,D.jsx)("div",{className:"parameter-knob",children:(0,D.jsx)(E,(0,r.Z)({displayValue:!0,onSetValue:s},o))})},V=t(915),q=t(3382),O=t(938),F=t(7864),R=Object.keys(h).map((function(e){return(0,r.Z)((0,r.Z)({},h[e]),{},{name:e})})),B=function(e){var n=e.onPlay,t=e.onSeekToStart,a=e.onSetParameter,o=e.onStop,s=e.parameters;return(0,D.jsx)("div",{className:"global-controls",children:(0,D.jsxs)(V.Z,{bordered:!1,children:[(0,D.jsxs)("div",{className:"control-row",children:[(0,D.jsx)(G,{onClick:t,children:(0,D.jsx)(q.Z,{})}),(0,D.jsx)(G,{onClick:n,children:(0,D.jsx)(O.Z,{})}),(0,D.jsx)(G,{onClick:o,children:(0,D.jsx)(F.Z,{})})]}),(0,D.jsx)("div",{className:"control-row",children:R.map((function(e){return(0,u.createElement)(P,(0,r.Z)((0,r.Z)({},e),{},{key:e.name,onSetParameter:a,value:s[e.name]}))}))})]})})},W=t(3433),$=t(9333),L=t(5581),T=t(7382),U=function(e){var n=e.channels,t=e.numOfChannels,r=e.onSetChannels,a=e.title,s=void 0===a?"Channels":a,c=u.useState(!1),i=(0,o.Z)(c,2),l=i[0],d=i[1],m=u.useCallback((function(){return d(!0)}),[d]),f=u.useCallback((function(e,t){return r(t?Array.from(new Set([].concat((0,W.Z)(n),[e]))).sort((function(e,n){return e>n?1:e<n?-1:0})):n.filter((function(n){return n!==e})))}),[t,r,n]),v=u.useMemo((function(){return(0,D.jsx)($.Z,{className:"midi-channels-menu",onClick:m,children:Array.from(Array(t)).map((function(e,t){return(0,D.jsx)($.Z.Item,{children:(0,D.jsxs)("div",{className:"menu-item",children:[(0,D.jsxs)("div",{children:[t+1," "]}),(0,D.jsx)(L.Z,{checked:n.includes(t+1),onChange:function(e){return f(t+1,e)},size:"small"})]})},t+1)}))})}),[n,t]),h=u.useMemo((function(){if(!n)return"";var e=n.reduce((function(e,n){return e.range.length>0&&n-e.range[e.range.length-1]>1?e.other.push(n):e.range.push(n),e}),{range:[],other:[]}),t=e.range,r=e.other;return t.length>1?"".concat(t[0],"-").concat(t[t.length-1]).concat(r.length>0?"..":""):[].concat((0,W.Z)(t),(0,W.Z)(r)).filter((function(e,n){return n<3})).join(",")+(r.length>2?"..":"")}),[n]);return(0,D.jsx)("div",{className:"numeric-parameter midi-channels",children:(0,D.jsx)(T.Z,{onVisibleChange:d,overlay:v,placement:"bottomRight",visible:l,children:(0,D.jsxs)("div",{children:[(0,D.jsx)("div",{className:"title",children:s}),(0,D.jsx)("div",{className:"content",children:h})]})})})},Y=t(4896),J=t(8243),z=function(e){var n=e.notes,t=e.onChange,r=u.useCallback((function(e){var r,a="number"===typeof e?e:Math.max(1,Math.min(120,parseInt(null===(r=e.target)||void 0===r?void 0:r.value)));t(a>n.length?[].concat((0,W.Z)(n),(0,W.Z)(Array.from(Array(a-n.length)).map((function(){return function(){return{note:arguments.length>0&&void 0!==arguments[0]?arguments[0]:d,on:!(arguments.length>2&&void 0!==arguments[2])||arguments[2],velocity:arguments.length>1&&void 0!==arguments[1]?arguments[1]:64}}()})))):n.slice(0,a))}),[n,t]);return(0,D.jsxs)("div",{className:"sequence-length-modifier numeric-parameter",children:[(0,D.jsx)("div",{className:"title",children:"# Pads"}),(0,D.jsx)(J.Z,{bordered:!1,max:120,min:1,onBlur:r,onPressEnter:r,onStep:r,defaultValue:(null===n||void 0===n?void 0:n.length)||1})]})},Q=Object.keys(v).map((function(e){return(0,r.Z)((0,r.Z)({},v[e]),{},{name:e})})),X=function(e){var n=e.activeNoteIdx,t=e.data,o=e.onSetData,c=t.noteDuration,i=t.transpose,l=u.useMemo((function(){return{noteDuration:c,transpose:i}}),[c,i]),d=y(Q,l),m=d.parameters,f=d.onSetParameter;u.useEffect((function(){return o((function(e){return(0,r.Z)((0,r.Z)({},e),m)}))}),[m]);var v,h=u.useCallback((function(e){return o((function(n){return(0,r.Z)((0,r.Z)({},n),{},{notes:e})}))}),[o]),p=u.useCallback((function(e){return o((function(n){return(0,r.Z)((0,r.Z)({},n),{},{channels:e})}))}),[o]),C=(v=o,{onClick:u.useCallback((function(e){return v((function(n){var t=n.notes,o=(0,a.Z)(n,Z);return(0,r.Z)((0,r.Z)({},o),{},{notes:t.map((function(n,t){return t===e?(0,r.Z)((0,r.Z)({},n),{},{on:!n.on}):n}))})}))}),[v]),onWheel:u.useCallback((function(e,n){return v((function(t){var o=t.notes,u=(0,a.Z)(t,g);return(0,r.Z)((0,r.Z)({},u),{},{notes:o.map((function(t,a){return a===e?(0,r.Z)((0,r.Z)({},t),{},{note:"up"===n?t.note+1:t.note-1}):t}))})}))}),[v])});return(0,D.jsxs)("div",{className:"step-sequencer",children:[(0,D.jsx)("div",{className:"controls",children:(0,D.jsxs)(V.Z,{bordered:!1,children:[(0,D.jsx)(z,{notes:null===t||void 0===t?void 0:t.notes,onChange:h}),(0,D.jsx)(U,{channels:null===t||void 0===t?void 0:t.channels,numOfChannels:Y.J5,onSetChannels:p,title:"Channels"}),Q.map((function(e){return(0,u.createElement)(P,(0,r.Z)((0,r.Z)({},e),{},{key:e.name,onSetParameter:f,value:m[e.name]}))}))]})}),(0,D.jsx)("div",{className:"pads-container",children:Array.isArray(null===t||void 0===t?void 0:t.notes)&&t.notes.map((function(e,t){var a=e.note,o=e.on;return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(S,(0,r.Z)((0,r.Z)({active:n===t,index:t,on:o},C),{},{children:(0,s.Qz)(a)}),a),(t+1)%8===0&&(0,D.jsx)("div",{className:"flex-breaker"})]})}))})]})},_=["activeNoteIdx"],H=function(){var e=u.useState(f.stepSequencers),n=(0,o.Z)(e,2),t=n[0],s=n[1],c=u.useState(0),i=(0,o.Z)(c,2),l=i[0],d=(i[1],u.useCallback((function(e){var n="function"===typeof e?e:function(){return e};s((function(e){return e.map((function(e,t){return t===l?n(e):e}))}))}),[s,l])),m=y(R),v=m.parameters,h=m.onSetParameter,p=function(e,n,t){var s=e.bpm,c=e.noteValue,i=(0,a.Z)(e,j),l=u.useContext(C.Z),d=l.selectedOutput,m=u.useState(null),f=(0,o.Z)(m,2),v=f[0],h=f[1],p=u.useRef((0,r.Z)((0,r.Z)({},i),{},{intervalId:null,intervalMillis:b(s,c),noteIdx:0,steps:k(n),tempoChangeRequested:null}));u.useEffect((function(){null!==p.current.intervalId?p.current.tempoChangeRequested=b(s,c):p.current.intervalMillis=b(s,c)}),[s,c]),u.useEffect((function(){Object.keys(i).forEach((function(e){p.current[e]=i[e]}))}),[i]),u.useEffect((function(){p.current.steps=k(n)}),[n]);var Z=u.useCallback((function(){var e=p.current,n=e.steps,t=e.noteIdx,r=e.tempoChangeRequested;r&&(clearInterval(p.current.intervalId),p.current.intervalMillis=r,p.current.tempoChangeRequested=null,p.current.intervalId=setInterval(Z,r));var a=n[t];h(t),p.current.noteIdx++,p.current.noteIdx>=n.length&&(p.current.noteIdx=0);var o=a.reduce((function(e,n){var t=n.channels,r=n.duration,a=n.note,o=n.on,u=n.velocity;return o&&u>0&&t.forEach((function(n){e.messages.push([x.XR["Channel".concat(n,"NoteOn")],a,u]),e.messagesOffGroups[r]||(e.messagesOffGroups[r]=[]),e.messagesOffGroups[r].push([x.XR["Channel".concat(n,"NoteOn")],a,0])})),e}),{messages:[],messagesOffGroups:{}}),u=o.messages,s=o.messagesOffGroups;u.length&&(u.forEach((function(e){return d.send(e)})),Object.keys(s).forEach((function(e){var n=s[e];setTimeout((function(){return n.forEach((function(e){return d.send(e)}))}),e)})))}),[d]);u.useEffect((function(){return t&&null!==l&&void 0!==l&&l.ready&&l.selectedOutput&&(p.current.intervalId=setInterval(Z,intervalMillis)),function(){clearInterval(p.current.intervalId),p.current.intervalId=null}}),[t]);var g=u.useCallback((function(){h(0),p.current.noteIdx=0}),[h]);return{activeNoteIdx:v,onPlay:u.useCallback((function(){null===p.current.intervalId&&(p.current.intervalId=setInterval(Z,p.current.intervalMillis))}),[Z]),onSeekToStart:g,onStop:u.useCallback((function(){clearInterval(p.current.intervalId),p.current.intervalId=null}),[])}}(v,t),Z=p.activeNoteIdx,g=(0,a.Z)(p,_);return(0,D.jsxs)("div",{className:"sequencer",children:[(0,D.jsx)(B,(0,r.Z)((0,r.Z)({},g),{},{parameters:v,onSetParameter:h})),(0,D.jsx)("div",{className:"step-sequencer",children:(0,D.jsx)(X,{activeNoteIdx:Z,data:t[l],onSetData:d})})]})}}}]);
//# sourceMappingURL=243.d537a6a5.chunk.js.map